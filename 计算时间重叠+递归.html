<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      var log = console.log;
      // const list = [
      //   { start: "12æœˆ10æ—¥", end: "1æœˆ10æ—¥" },
      //   { start: "1æœˆ3æ—¥", end: "1æœˆ13æ—¥" },
      //   { start: "1æœˆ5æ—¥", end: "1æœˆ11æ—¥" },
      //   { start: "1æœˆ7æ—¥", end: "1æœˆ14æ—¥" },
      //   { start: "1æœˆ16æ—¥", end: "1æœˆ18æ—¥" },
      // ];
      // // var arr1 = list.map(r=>Object.values(r)).map(rr=>{
      // //   // log(rr)
      // //   return rr.map(rrr=>rrr.match(/\d+/g).join('/'))
      // // })
      // var arr1 = list
      //   .map((r) => Object.values(r))
      //   .map((rr) => rr.map((rrr) => rrr.match(/\d+/g).join("/")));
      // const msByDay = 60 * 60 * 24 * 1000; //millionsecondsByDay
      // log(arr1, 57);
      // const yy = new Date().getFullYear();
      // log(yy, 59);
      // arr1 = arr1.map((r) => {
      //   if (r[0].split("/")[0] > r[1].split("/")[0]) {
      //     log(yy, 59);
      //     r[0] = yy + "/" + r[0];

      //     r[1] = yy + 1 + "/" + r[1];
      //   } else {
      //     log(yy, 59);
      //     r[0] = yy + "/" + r[0];
      //     r[1] = yy + "/" + r[1];
      //   }
      //   return r;
      // });
      // log(arr1);
      
      /* å»é™¤å­—ç¬¦ä¸²ç©ºæ ¼ */
      // function findLongestWordLength(str) {
      //   console.log(str.split('\xa0'));
      //   console.log(str.split(/\s/));
      //   console.log(str.match(/\S+/g));
      //   console.log(str.replace(/\s/g,''));
      // }
      // findLongestWordLength("TheÂ quickÂ  brownÂ foxÂ jumpedÂ overÂ theÂ lazyÂ dog");

      /* ä¸æ¨èä½¿ç”¨ */
      // function getMaxCode4(str) {
      //   // const strArr = str.split("");
      //   const strArr = str.match(/\d/g);
      //   let count = 0,
      //     word;
      //   const set = new Set(str);
      //   // log(set, 30)
      //   for (const i of set) {
      //   //   log(i)
      //     const filterArr = strArr.filter((r) => r === i);
      //   //   log(filterArr)
      //     if (filterArr.length > count) {
      //       count = filterArr.length;
      //       word = i;
      //     }
      //   }

      //   return `${word},${count}ä¸ª`;
      // }
      // log(getMaxCode4("12454843161843225"));

      /* é€’å½’orNot */
      // const arr = [
      //   {
      //     id: 1,
      //     children: [
      //       {
      //         id: 2,
      //       },
      //       {
      //         id: 3,
      //         children: [
      //           {
      //             id: 4,
      //           },
      //         ],
      //       },
      //     ],
      //   },
      //   {
      //     id: 5,
      //     children: [
      //       {
      //         id: 6,
      //       },
      //     ],
      //   },
      // ];
      const arr = [
        { id: "29", pid: "", name: "æ€»è£åŠ" },
        { id: "2c", pid: "", name: "è´¢åŠ¡éƒ¨" },
        { id: "2d", pid: "2c", name: "è´¢åŠ¡æ ¸ç®—éƒ¨" },
        { id: "2f", pid: "2c", name: "è–ªèµ„ç®¡ç†éƒ¨" },
        { id: "d2", pid: "", name: "æŠ€æœ¯éƒ¨" },
        { id: "d3", pid: "d2", name: "Javaç ”å‘éƒ¨" },
      ];
      const arr2 = JSON.parse(JSON.stringify(arr));
      function list2Tree(list) {
        const treeList = [],
          map = {};
        list.forEach((item) => {
          if (!item.children) {
            item.children = [];
          }
          map[item.id] = item;
        });
        // log(map, 56);
        list.forEach((item) => {
          const parent = map[item.pid];
          if (parent) {
            parent.children.push(item);
          } else {
            treeList.push(item);
          }
        });
        return treeList;
      }
      log(list2Tree(arr));
      log(arr);

      function treeArr(parent) {
        let kong = [];
        arr2.forEach((item) => {
          if (item.pid === parent) {
            item.children = treeArr(item.id);
            kong.push(item);
          }
        });
        return kong;
      }

      let xxx = treeArr("");
      function shanchu(list) {
        list.forEach((item) => {
          delete item.pid;
          // 151è¡Œæ˜¯å¦æ³¨é‡Šï¼Œçœ‹æƒ…å†µ
          if (!item.children.length) delete item.children;
          if (item.children) {
            shanchu(item.children);
          }
        });
        return list;
      }
      log(shanchu(xxx));

      // // function find(array, param, paramKey = "id", childrenKey = "children") {
      // //   let res;
      // //   for (let index = 0; index < array.length; index++) {
      // //     function fn() {
      // //       if (array[index][paramKey] === param) return array[index];
      // //       if (array[index][childrenKey] && array[index][childrenKey].length)
      // //         return find(array[index][childrenKey], param);
      // //     }
      // //     if (fn()) {
      // //       res = fn();
      // //       break;
      // //     }
      // //   }
      // //   return res;
      // // }
      // function find(arr, id) {
      //   var res = null;
      //   var fn = function (arr) {
      //     if (Array.isArray(arr)) {
      //       arr.forEach((item) => {
      //         if (item.id === id) {
      //           res = item;
      //         } else if (item.children) {
      //           fn(item.children);
      //         }
      //       });
      //     }
      //   };
      //   fn(arr); // è°ƒç”¨ä¸€ä¸‹
      //   return res;
      // }
      // log(find(arr, 1));
      // log(find(arr, 2));
      // log(find(arr, 5));

      // let hd = 'courage.look up to,think highly ofï¼'
      // let mathStr = 'â…¢â…¡666â…«_\n-â€”â€”'
      // log(hd.match(/\p{L}+/ug)) // Letterå­—æ¯
      // log(mathStr.match(/\p{N}+/ug)) // Numberæ•°å­— åŒ…å«æ‹‰ä¸æ•°å­—
      // log(mathStr.match(/\p{Nl}+/ug)) // Letter_Numberæ‹‰ä¸æ•°å­—
      // log(hd.match(/\p{P}+/ug).join('')) // Punctuationæ ‡ç‚¹ç¬¦å·
      // log(hd.match(/\W+/g).map(r=>r.replace(/\s/g,'')).filter(r=>r).join(''))
      // log(hd.match(/\S+/g).map(r=>r.replace(/\w/g,'')).filter(Boolean).join(''))
      // log(hd.match(/\W+/g).join('').replace(/\s/g,''))

      let hdd = `å¼ ä¸‰:010-99999999,æå››:020-88888888ë„¤ê°€ ë‚˜ë¥¼ ì‚¬ë‘í•˜ëŠ” ê²ƒ ë³´ë‹¤ ë‚´ÎŒÎ¼Ï‰Ï‚ ÏŒÎ½Ï„Ï‰Ï‚ ÏƒÎµ Î±Î³Î±Ï€Ï ÎºÎ±Î¹ ÎµÏ€ÎµÎ¹Î´Î® ÏƒÎµ Î±Î³Î±Ï€Ï, Î½Î¿Î¹Î¬Î¶Î¿Î¼Î±Î¹ Î³Î¹Î± Ï„Î¿ Ï€Î¿Î¹Î¿Ï‚ Î¸Î± Î³Î¯Î½ÎµÎ¹Ï‚.`;
      let resGreek = hdd.match(/\p{sc=Greek}+/gu);
      let resHangul = hdd.match(/\p{sc=Hangul}+/gu);
      console.log(resGreek, resHangul);

      // let str = "ğ’³ğ’´";
      // console.log(str.match(/[ğ’³ğ’´]/ug));

      // var hd = `ç¦æ­¢è´ªå©ª:12345678,999999999,88888888`;
      // let reg = /(\d+),?/y;
      // // reg.lastIndex = 7;
      // reg.lastIndex = hd.indexOf(':')+1;
      // while ((res = reg.exec(hd))) console.log(res[1]);
      
      /* valueOfé¢è¯•é¢˜ */
      // var a = {
      //   i: 1,
      //   valueOf: () => {
      //     return (a.i++)**2;
      //   },
      //   // toString: () => {
      //   //   return (a.i++)**2;
      //   //   // return Math.pow(a.i++,2);
      //   // },
      // };
      // log(a == 1 && a == 4 && a == 9);

      //   const st = "hope2get4u3keyou";
      //   let letterArr = [...st].filter((r) => Number.isNaN(parseInt(r)));
      //   let numAr1 = [...st].filter((r) => !letterArr.includes(r));
      //   let numAr2 = [...st].filter((r) => !letterArr.some((rr) => rr === r));
      //   let numAr3 = [...st].filter((r) => !Number.isNaN(parseInt(r)));
      //   log(numAr3);
      //   log(st.match(/\d/g));

      /* å¸¸å¾·æ‹›å©¿æ‰‹æœºå· */
      //   var arr = new Array(1, 5, 6, 0, 7, 4, 9, 3);
      //   var indexArr = new Array(0, 1, 2, 3, 4, 0, 5, 1, 2, 6, 7);
      //   var tel = "";
      //   for (var i = 0; i < indexArr.length; i++) {
      //     tel += arr[indexArr[i]];
      //   }
      //   log(tel);

      //   var arr = new Array(new Date().getFullYear() - 2015).keys();
      //   log(Array.from(arr).map((v) => v + 2015));
      //   function* a(start) {
      //     while (start < new Date().getFullYear()) {
      //       yield start++;
      //     }
      //   }
      //   log([...a(2015)]);

      // var b = 10;
      // (function b() {
      //   b = 20;
      //   console.log(b);
      // })();


      /*
        1.äº¤æ¢å¾‹ï¼ša ^ b ^ c  <=> a ^ c ^ b
        2.ä»»ä½•æ•°äº0å¼‚æˆ–ä¸ºä»»ä½•æ•° 0 ^ n => n
        3.ç›¸åŒçš„æ•°å¼‚æˆ–ä¸º0: n ^ n => 0

        äº¤æ¢æ•°ç»„ä¸¤ä¸ªæ•°çš„ä½ç½®
        const arr = [1, 2]
        [a, b] = arr 
        a = a ^ b
        b = b ^ a
        a = a ^ b
      */

      /* loadshçš„getæ–¹æ³• */
      deeplyObj = {
        a: {
          b: {
            c: {
              d: 123,
            },
          },
        },
      };

      function safeGet(obj, props, val) {
        if (!obj) return;
        if (!props) {
          if (val) return;
          return;
        }
        let result = JSON.parse(JSON.stringify(obj));
        // const propsArr = props.replace(/\s+/, "").split(".");
        const propsArr = props.match(/\w+/g);
        console.log(propsArr);
        // for (let i = 0, l = propsArr.length; i < l; i++) {
        //   debugger
        //   const key = propsArr[i];
        //   if (key === "") continue;
        //   result = result[key];
        //   if (!result) {
        //     break;
        //   }
        // }
        while ((key = propsArr.shift())) {
          if (key === "") continue;
          result = result[key];
          if(!result) break;
        }
        return result || val;
      }

      console.log(safeGet(deeplyObj, "a.  b..c.d"));
      console.log(safeGet(deeplyObj, "a.b"));
      console.log(safeGet(deeplyObj, "a.b.c.d1"));
      console.log(safeGet(deeplyObj, "a.b.c.d1", "hahah"));

      /* æ—¶åˆ†ç§’ä¸€å¥è¯ */
      let t = new Date()
      t = t.toLocaleString().replace(/\//g, '-').replace(/-(\d)\b/g, '-0$1').replace(/ä¸Šåˆ(\d+)/, (t.getHours() > 10 ? '' : '0') + '$1').replace(/ä¸‹åˆ\d+/, t.getHours())
      log(t)

      /* ä¸ç”¨åŠ å‡ä¹˜é™¤è¿ç®—ç¬¦ï¼Œæ±‚æ•°å­—å€æ•°
      å‘å·¦ä½ç§»ä¸€ä½ï¼Œå–è¿›åˆ¶ */
      // let multiply = function (num, multiple) {
      //   return parseInt([num.toString(multiple), "0"].join(""), multiple);
      // };
      // log(multiply(2, 3));
      // log(multiply(3, 7));
      // log(multiply(4, 8));

      // for (var i = 0; i <= 20; i++) {
      //   log(i,parseInt(i, 7));
      // }

      // function bitAdd(m, n) {
      //   debugger;
      //   while (m) {
      //     [m, n] = [(m & n) << 1, m ^ n];
      //   }
      //   return n;
      // }
      // bitAdd(7, 7);

      /* é€’å½’ å®ç° é€†åºæ•°å­— */
      function fa(num) {
        let a = num / 10;
        let b = num % 10;
        if (a < 1) return num;
        else {
          a = Math.floor(a);
          return `${b}${fa(a)}`;
        }
      }

      /* é€†åºå­—ç¬¦ä¸² reverse */
      function fb(num) {
        let arr = num.toString().split("");
        const kong = new Array();
        // let val;
        while ((val = arr.pop())) {
          kong.push(val);
        }
        return kong.join("");
      }
      log(fa(100345500) === fb(100345500));

      // String.prototype.reverse = function () {
      //   var _ths = this.toString().split("");
      //   var left = 0; //å­˜å‚¨å·¦è¾¹ç¬¬ä¸€ä¸ªä½ç½®
      //   var right = _ths.length - 1; //å­˜å‚¨å³è¾¹æœ€åä¸€ä¸ªä½ç½®
      //   while (left < right) {
      //     //åœæ­¢è¿›è¡Œçš„æ¡ä»¶
      //     var temp = _ths[left]; //åˆ©ç”¨ä¸€ä¸ªä¸­é—´å˜é‡æ¥äº¤æ¢ä½ç½®
      //     _ths[left] = _ths[right];
      //     _ths[right] = temp;
      //     left++;
      //     right--;
      //   }
      //   return _ths.join("");
      // };

      // String.prototype.reverse = function () {
      //   var _ths = this.toString();
      //   var len = _ths.length;
      //   var str = "";
      //   for (var i = 0; i < len; i++) {
      //     var temp = _ths[i];
      //     _ths[i] = _ths[len - 1 - i];
      //     _ths[len - 1 - i] = temp;
      //     str += _ths[len - 1 - i];
      //   }
      //   return str;
      // };
      // log("abcdefg".reverse());
      // log(new Date().toLocaleDateString().reverse());

      /* æ‰‹æ’¸flat */
      // const arr = ["ä¸€çº§", ["äºŒçº§", ["ä¸‰çº§", ["å››çº§"]]], 5, "string", { name: "xxxx" }];
      // // concat + é€’å½’
      // function flat(arr) {
      //   let arrResult = [];
      //   arr.forEach((item) => {
      //     if (Array.isArray(item)) {
      //       log(arguments,arguments.callee(item),53)
      //       arrResult = arrResult.concat(arguments.callee(item)); // é€’å½’
      //       // æˆ–è€…ç”¨æ‰©å±•è¿ç®—ç¬¦
      //       // arrResult.push(...arguments.callee(item));
      //     } else {
      //       arrResult.push(item);
      //     }
      //   });
      //   return arrResult;
      // }
      // log(flat(arr));
      // [1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 1, 2, 3, 5, "string", { name: "å¼¹é“è›‹åŒå­¦" }];

      // æ ˆæ€æƒ³
      function flat(arr) {
        const result = [];
        const stack = [].concat(arr); // å°†æ•°ç»„å…ƒç´ æ‹·è´è‡³æ ˆï¼Œç›´æ¥èµ‹å€¼ä¼šæ”¹å˜åŸæ•°ç»„
        // const stack = arr.slice(); // æµ…æ‹·è´
        // const stack = [...arr]; // æµ…æ‹·è´
        //å¦‚æœæ ˆä¸ä¸ºç©ºï¼Œåˆ™å¾ªç¯éå†
        while (stack.length !== 0) {
          // debugger
          const val = stack.pop();
          if (Array.isArray(val)) {
            stack.push(...val); //å¦‚æœæ˜¯æ•°ç»„å†æ¬¡å…¥æ ˆï¼Œå¹¶ä¸”å±•å¼€äº†ä¸€å±‚
          } else {
            result.unshift(val); //å¦‚æœä¸æ˜¯æ•°ç»„å°±å°†å…¶å–å‡ºæ¥æ”¾å…¥ç»“æœæ•°ç»„ä¸­
          }
        }
        return result;
      }
      const ar = ["ä¸€çº§", ["äºŒçº§", ["ä¸‰çº§", ["å››çº§"]]], 5, "string", { name: "xxxx" }];
      log(flat(ar));

      /* ç»Ÿè®¡æ•°ç»„ä¸­æ¯ä¸ªå€¼ï¼Œæ¯”å¤§å° */
      let data = [
        { data: 1 },
        { data: 4 },
        { data: 7 },
        { data: 3 },
        { data: 6 },
        { data: 8 },
        { data: 7.2 },
        { data: 7.3 },
      ];

      let foo = function (data) {
        let returnData = [];
        data.forEach((item, index) => {
          let itemObj = { value: item.data, count: 0 };
          for (let i = index; i >= 0; i--) {
            if (item.data >= data[i].data) itemObj.count++;
            else break;
          }
          returnData.push(itemObj);
        });
        return returnData;
      };
      log(foo(data));

      /* Unicodeä¸­æ–‡æ±‰å­—ç¼–ç 16è¿›åˆ¶è½¬åè¿›åˆ¶ */
      function getNum(str) {
        var st = "0123456789abcdef";
        var sLen = str.length - 1;
        var num = 0;
        for (var i = 0; i <= sLen; i++) {
          num += st.indexOf(str[i]) * 16 ** (sLen - i);
        }
        return num;
      }
      log(getNum("4e00"));
      log(getNum("9fa5"));

      /* åŸå§‹æ•°æ®  [1, "2", 3, "4"];
      æœŸæœ›æ•°æ® { number: [1, 3], string: ["2", "4"] }; */
      var arrr = [1, "2", 3, "4"];
      // let tpArr = arr.map((r) => ({ [typeof r]: r }));
      // let ar2 = [...new Set(tpArr.map((r) => Object.keys(r)).flat())];
      // // log(tpArr, ar2);
      // ar2 = ar2
      //   .map((tp) => ({
      //     [tp]: tpArr
      //       .filter((r) => Object.keys(r).join() === tp)
      //       .reduce((t, r) => t.concat(r[tp]), []),
      //   }))
      //   .reduce((t, r) => Object.assign(t, r), {});
      // log(ar2);
      let obj = new Object();
      obj = arrr.map((r) => typeof r).reduce((res, item, i) => {
          // debugger
          res[item] = [...(res[item] || []), arrr[i]];
          return res;
        }, {});
      log(obj);

      /* æ’åˆ—æ±‚å’Œ */
      function combination(m, n) {
        var a = 1; //åˆ†æ¯
        var b = 1; //åˆ†å­
        if (m > n) return;
        for (var i = 1; i <= m; i++) {
          a *= i; //åˆ†æ¯
        }
        for (var j = n - m + 1; j <= n; j++) {
          b *= j; //åˆ†å­
        }
        return b / a;
      }
      function combinationSum(b) {
        var sum = 0;
        for (var i = 1; i <= b; i++) {
          sum += combination(i, b);
        }
        return sum;
      }
      log(combinationSum(2));//3 ['a','b','ab']
      log(combinationSum(4));//15
      log(combinationSum(26));//67108863

     /*
     å·²çŸ¥ä¸€ä¸ªåŒ…å«nä¸ªæ•°å­—çš„æ•°ç»„A,
     å…¶ä¸­è¿ç»­å¤šä¸ªæ•°å­—çš„å’Œä¸ºsum,
     è¯·æ‰¾å‡ºè¯¥è¿ç»­æ•°å­—çš„åˆå§‹ç´¢å¼•startå’Œç»“æŸç´¢å¼•end?
     */
    //   let nums = [1, 3, 2, 7, 4, 1, 2, 3, 6, 7, 8, 1, 2, 3];
    //   let sum = 6;
    //   function getIndexBySum(nums, sum) {
    //     let ans = [];
    //     for (let i = 0; i < nums.length; i++) {
    //       let j = i;
    //       let temp = 0;
    //       while (j < nums.length && temp < sum) {
    //         temp += nums[j];
    //         j++;
    //       }
    //       if (temp === sum) ans.push([i, j - 1]);
    //     }
    //     return ans;
    //   }
    //   log(getIndexBySum(nums, sum));

      /* æ‰¾å‡º26ä¸ªå­—æ¯çš„æ‰€æœ‰ç»„åˆ */
      // var ltArr = new Array();
      // for (var i = 97; i <= 122; i++) {
      //   ltArr.push(String.fromCharCode(i));
      // }
      // let str = ltArr.join("");
      // ans = [];
      // temp = [];
      // function backTracking(level) {
      //   if (level > str.length) return;
      //   if (temp.length !== 0) ans.push(temp.join(""));
      //   for (let i = level; i < str.length; i++) {
      //     // debugger;
      //     temp.push(str.charAt(i));
      //     backTracking(i + 1);
      //     temp.pop();
      //   }
      // }
      // backTracking(0);
      // console.time()
      // log(ans, ans.length);
      // console.timeEnd()

      /* map forEach forå¾ªç¯ */
      // Array.prototype.mapL = function (cb) {
      //   const res = [];
      //   for (let i = 0; i < this.length; i++) {
      //     res.push(cb(this[i], i, this));
      //   }
      //   return res;
      // };
      let a = [1, 2, 3];
      // a.forEach((n, i) => (a[i] = a[i] + 2));
      // a = a.map((n) => n + 2);
      // a = a.map((n) => (n += 2));
      // for (let i = 0; i < a.length; i++) {
      //   a[i] += 2;
      // }
      a.forEach(function (n, i) {
        log(n === a[i]);
        a[i] += 2;
      });
      log(a);

      /* æ•´æ•° æˆ– ä¿ç•™å°æ•°ç‚¹åä¸¤ä½ */
      /^([1-9][0-9]*(\.\d{1,2})?|0(\.\d{1,2})?)$/.test('0.00')

      /* ç»Ÿè®¡å°äºnçš„æœ€å¤§è´¨æ•° */
      var countPrimes = function (n) {
        var isPrime = [],
          i = 0,
          j = 0,
          // ans = 0;
          kong = [];
        for (i = 0; i < n; i++) {
          isPrime[i] = true;
        }
        for (i = 2; i * i < n; i++) {
          for (j = i * i; j < n; j += i) {
            // i æ•´é™¤ j ä¸” j < n
            isPrime[j] = false;
          }
        }
        for (i = 2; i < n; i++) {
          // ç»Ÿè®¡è´¨æ•°
          if (isPrime[i]) {
            // ans++;
            // log(i);
            kong.push(i);
          }
        }
        // return ans;
        return kong;
      };
      log(countPrimes(97));
    </script>
  </body>
</html>
+++++++++++++++++++++++++++++++++++++++++++
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿„ç½—æ–¯æ–¹å—-01</title>

    <script src="./lodash.min.js"></script>

    <style>
        .container {
            width: 200px;
            height: 360px;
            background: url('bg.png') no-repeat;
            background-size: 200px 360px;
            /* background-color: black; */
            position: relative;
            box-shadow: 3px 3px 5px #888888;
        }

        .activity_model {
            width: 20px;
            height: 20px;
            /* opacity: 0.8; */
            box-sizing: border-box;
            border: .3px solid #676767;
            position: absolute;
            top: 0;
            left: 0;
            background: #ffd75e url("logo.png") center center no-repeat;
            background-size: 15px;
            box-shadow: 2px 2px 5px #888888;
        }

        .fixed_model {
            width: 20px;
            height: 20px;
            /* background-color: #9e9e9e; */
            box-sizing: border-box;
            border: .3px solid #676767;
            position: absolute;
            top: 0;
            left: 0;
            background: #bbbbbb url("logo.png") center center no-repeat;
            background-size: 15px;
            box-shadow: 2px 2px 5px #888888;
        }
    </style>
</head>

<body onload="init()">
    <div id="container" class="container">

    </div>
</body>

<script>
    // å¸¸é‡
    // æ­¥é•¿
    var STEP = 20;
    // åˆ†å‰²å®¹å™¨
    // 18è¡Œ ï¼Œ 10åˆ—
    var ROW_COUNT = 18;
    var COL_COUNT = 10;

    // å®šä¹‰16å®«æ ¼çš„æ¨¡å‹æº
    var MODELS = [
        // ç¬¬ä¸€ä¸ªæ ·å¼(L)
        {
            0: {
                row: 2,
                col: 0
            },
            1: {
                row: 2,
                col: 1
            },
            2: {
                row: 2,
                col: 2
            },
            3: {
                row: 1,
                col: 2
            },
        },
        // ç¬¬äºŒä¸ªæ ·å¼(å‡¸)
        {
            0: {
                row: 1,
                col: 1
            },
            1: {
                row: 0,
                col: 0
            },
            2: {
                row: 1,
                col: 0
            },
            3: {
                row: 2,
                col: 0
            },
        },
        //  ç¬¬ä¸‰ä¸ªæ ·å¼(ç”°)
        {
            0: {
                row: 1,
                col: 1
            },
            1: {
                row: 2,
                col: 1
            },
            2: {
                row: 1,
                col: 2
            },
            3: {
                row: 2,
                col: 2
            },
        },
        // ç¬¬å››ä¸ªæ ·å¼(ä¸€)
        {
            0: {
                row: 0,
                col: 0
            },
            1: {
                row: 0,
                col: 1
            },
            2: {
                row: 0,
                col: 2
            },
            3: {
                row: 0,
                col: 3
            },
        },
        // ç¬¬äº”ä¸ªæ ·å¼(Z)
        {
            0: {
                row: 1,
                col: 1
            },
            1: {
                row: 1,
                col: 2
            },
            2: {
                row: 2,
                col: 2
            },
            3: {
                row: 2,
                col: 3
            },
        }
    ]

    // å½“å‰çš„æ¨¡å‹æº
    var currentModel = {}
    // 16å®«æ ¼æ‰€åœ¨çš„ä½ç½®
    var currentX = 0;
    var currentY = 0;
    // ä¿å­˜æ‰€æœ‰å·²ç»è¢«å›ºå®šçš„æ¨¡å—
    // K=è¡Œæ•°_åˆ—æ•° : V=å…ƒç´ 
    var fixedBlocks = {}
    // å®šæ—¶å™¨
    var mInterval = null;

    // å†å…ƒç´ åˆ›å»ºå®Œæˆä¹‹åå›è°ƒ
    function init() {
        createModel();
        onKeyDown();
    }

    // ç”Ÿæˆå¯¹åº”æ¨¡å‹
    function createModel() {
        // åœ¨åˆ›å»ºæ–°æ¨¡å‹ä¹‹å‰ï¼Œåˆ¤æ–­æ¸¸æˆæ˜¯å¦å·²ç»ç»“æŸäº†
        if (isGameOver()) {
            // å¦‚æœæ¸¸æˆå·²ç»ç»“æŸäº†ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å†è‡ªåŠ¨é™è½æ¨¡å‹äº†
            gameOver();
            return;
        };
        // å½“å‰çš„æ¨¡å‹æ•°æ®æº
        currentModel = MODELS[_.random(0, MODELS.length - 1)];
        // åˆå§‹åŒ– 16å®«æ ¼çš„ä½ç½®
        currentX = 0;
        currentY = 0;
        // æ ¹æ®å½“å‰çš„æ•°æ®æºæ¥åˆ›å»ºå¯¹åº”æ•°é‡çš„å—å…ƒç´ 
        for (var key in currentModel) {
            var divEle = document.createElement("div");
            divEle.className = "activity_model";
            document.getElementById("container").appendChild(divEle);
        }
        // å®šä½å…ƒç´ 
        locationBlocks();
        // è‡ªåŠ¨é™è½
        autoDown();
    }

    // å®šä½æ¯ä¸ªæ¨¡å‹çš„ä½ç½®
    function locationBlocks() {
        // åˆ¤æ–­æ¨¡å—æ˜¯å¦è¶Šç•Œäº†
        checkBound();

        var eles = document.getElementsByClassName("activity_model");
        // é¦–å…ˆæ‹¿åˆ°å¯¹åº”çš„å—å…ƒç´ 
        for (var i = 0; i < eles.length; i++) {
            var blockEle = eles[i];
            // æœ‰å½“å‰å—å…ƒç´ å¯¹åº”çš„æ•°æ®æº
            var blockModel = currentModel[i];
            // ä¾æ®16å®«æ ¼çš„åŸç†ï¼Œæ¥å®šä½å—å…ƒç´ 
            blockEle.style.top = (currentY + blockModel.row) * STEP + "px";
            blockEle.style.left = (currentX + blockModel.col) * STEP + "px";
        }

    }

    // ç›‘å¬é”®ç›˜äº‹ä»¶
    function onKeyDown() {
        document.onkeydown = function (event) {
            switch (event.keyCode) {
                case 38:
                    console.log("ä¸Š");
                    rotate();
                    break;
                case 39:
                    console.log("å³");
                    move(1, 0);
                    break;
                case 40:
                    console.log("ä¸‹");
                    move(0, 1);
                    break;
                case 37:
                    console.log("å·¦");
                    move(-1, 0);
                    break;
            }
        }
    }

    // ç§»åŠ¨æ¨¡å‹
    // x è¡¨ç¤ºåœ¨ X è½´ç§»åŠ¨çš„æ­¥æ•°
    // y è¡¨ç¤ºåœ¨ y è½´ç§»åŠ¨çš„æ­¥æ•°
    function move(x, y) {
        // // æ‹¿åˆ°æ´»åŠ¨çš„å—
        // var activityModelEle = document.getElementsByClassName("activity_model")[0]
        // // æ”¹å˜æ¨¡å—çš„ top å’Œ left
        // activityModelEle.style.top = parseInt(activityModelEle.style.top || 0) + (y * STEP) + 'px';
        // activityModelEle.style.left = parseInt(activityModelEle.style.left || 0) + (x * STEP) + 'px';

        // å½“æ¨¡å—è¿›è¡Œç§»åŠ¨å¼ï¼Œéœ€è¦åˆ¤æ–­å°†è¦ç§»åŠ¨åˆ°çš„ä½ç½®æ˜¯å¦å¯ä»¥ç§»åŠ¨
        if (isMeet(currentX + x, currentY + y, currentModel)) {
            // å°†è¦ç§»åŠ¨åˆ°çš„ä½ç½®ä¼šå‘ç”Ÿç¢°æ’
            // å¹¶ä¸”ç¢°æ’æ˜¯æ¥è‡ªäºåº•éƒ¨çš„ç¢°æ’
            if (y !== 0) {
                fixedBottomModel();
            }
            return;
        }

        // è¡¨ç¤º 16 å®«æ ¼ç§»åŠ¨ä¹‹åçš„è·ç¦»
        currentX += x;
        currentY += y;
        // å¸¦åŠ¨æ¨¡å‹ç§»åŠ¨
        locationBlocks();
    }

    // æ¨¡å‹çš„æ—‹è½¬
    function rotate() {
        // å½“æ¨¡å—è¿›è¡Œæ—‹è½¬æ—¶ï¼Œéœ€è¦åˆ¤æ–­å°†è¦æ—‹è½¬é“å¾·ä½ç½®æ˜¯å¦å¯ä»¥è¿›è¡Œæ—‹è½¬
        var cloneCurrentModel = _.cloneDeep(currentModel);

        // éå†æ¨¡å‹æ•°æ®æº
        for (var key in cloneCurrentModel) {
            // æ‹¿åˆ°å¯¹åº”çš„å—æ¨¡å‹æ•°æ®
            var blockModel = cloneCurrentModel[key];
            // å®ç°ç®—æ³•ï¼Œ
            // ç§»åŠ¨åçš„è¡Œ = ç§»åŠ¨å‰çš„åˆ—
            // ç§»åŠ¨åçš„åˆ— = 3 - ç§»åŠ¨å‰çš„è¡Œ
            var temp = blockModel.row;
            blockModel.row = blockModel.col;
            blockModel.col = 3 - temp;
        }
        // å·²ç»å®šä½äº†å°†è¦æ—‹è½¬åˆ°çš„ä½ç½®
        if (isMeet(currentX, currentY, cloneCurrentModel)) {
            return;
        }

        currentModel = cloneCurrentModel;

        // é‡æ–°å®šä½æ¨¡å‹
        locationBlocks();
    }

    // æ§åˆ¶æ¨¡å‹åªèƒ½åœ¨å®¹å™¨ä¸­ç§»åŠ¨
    function checkBound() {
        // å®šä¹‰å®¹å™¨è¾¹ç•Œ
        var leftBound = 0,
            rightBound = COL_COUNT,
            bottomBound = ROW_COUNT;
        // å½“æ¯æ¬¡æ¨¡å‹ç§»åŠ¨äº†ä¹‹åï¼Œæˆ‘ä»¬æ¥åˆ¤æ–­æ¨¡å‹æ˜¯å¦è¶…å‡ºäº†è¾¹ç•Œ
        for (var key in currentModel) {
            var blcokModel = currentModel[key];
            // å·¦ä¾§è¶Šç•Œ
            if ((blcokModel.col + currentX) < leftBound) {
                currentX++;
            }
            // å³ä¾§è¶Šç•Œ
            if ((currentX + blcokModel.col) >= rightBound) {
                currentX--;
            }
            // åº•éƒ¨è¶Šç•Œ
            if ((currentY + blcokModel.row) >= bottomBound) {
                currentY--;
                fixedBottomModel();
            }
        }
    }

    // è®©æ–¹å—å›ºå®šåœ¨åº•éƒ¨
    function fixedBottomModel() {
        // 1ã€å½“æ¨¡å—ä¸åº•éƒ¨è¿›è¡Œæ¥è§¦çš„æ—¶å€™ï¼Œæ‰§è¡Œè¯¥æ–¹æ³•
        // 2ã€ä¿®æ”¹æ¨¡å‹çš„æ ·å¼ï¼Œå˜ä¸ºç°ç™½è‰²ï¼Œæ”¹å˜æ¨¡å‹ç±»å
        // 3ã€ä¸å†å…è®¸æ¨¡å‹ç§»åŠ¨äº†

        var eles = document.getElementsByClassName("activity_model");
        for (var i = eles.length - 1; i >= 0; i--) {
            var activityModelEle = eles[i];
            activityModelEle.className = "fixed_model";

            // æŠŠè¯¥æ¨¡å‹æ·»åŠ åˆ°æ•°æ®æºä¸­
            var blockModel = currentModel[i];
            // X: 16å®«æ ¼æ‰€åœ¨çš„ Xåæ ‡ä½ç½®+ å¿«å…ƒç´ åœ¨16å®«æ ¼ä¸­çš„åˆ—æ•°
            // Yï¼š16å®«æ ¼æ‰€åœ¨çš„ Yåæ ‡ä½ç½® + å—å…ƒç´ åœ¨16å®«æ ¼ä¸­çš„ä¸€ä¸ªè¡Œæ•°
            fixedBlocks[(currentY + blockModel.row) + "_" + (currentX + blockModel.col)] = activityModelEle;
        }

        // åˆ¤æ–­ä¸€è¡Œæ˜¯å¦è¢«é“ºæ»¡äº†
        isRemoveLine();

        // åˆ›å»ºæ–°çš„æ¨¡å‹
        createModel();
    }

    // å¤„ç†æ¨¡å—ä¹‹é—´çš„ç¢°æ’
    // xï¼Œyï¼šæ˜¯16å®«æ ¼å°†è¦ç§»åŠ¨åˆ°çš„ä½ç½®
    function isMeet(x, y, model) {
        // åˆ¤æ–­å½“å‰æ´»åŠ¨çš„æ¨¡å‹å’Œå›ºå®šçš„æ¨¡å‹åæ ‡æ˜¯å¦é‡å äº†
        // åˆ¤æ–­è¢«å›ºå®šçš„æ•°æ®æºä¸­æ˜¯å¦å¯ä»¥æ ¹æ®å½“å‰æ´»åŠ¨çš„å—å…ƒç´ ä½ç½®å¾—åˆ°å¯¹åº”çš„å…ƒç´ 

        // éå†å½“å‰æ¨¡å‹ï¼Œå°†å—è¿›è¡Œä¾æ¬¡çš„å¯¹æ¯”
        for (var key in model) {
            var blcokModel = model[key];
            // åˆ¤æ–­å½“å‰å—å…ƒç´ æ‰€åœ¨çš„ä½ç½®ä¸Šæ˜¯å¦å·²ç»æœ‰äº†å…¶ä»–çš„å—å…ƒç´ äº†
            if (fixedBlocks[(y + blcokModel.row) + "_" + (x + blcokModel.col)]) {
                return true;
            }
        }
        return false;
    }

    // åˆ¤æ–­ä¸€è¡Œæ˜¯å¦è¢«é“ºæ»¡
    function isRemoveLine() {
        // å¦‚æœä¸€è¡Œä¸­æ¯ä¸€åˆ—éƒ½å­˜åœ¨å—å…ƒç´ ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºè¯¥è¡Œå·²ç»è¢«é“ºæ»¡äº†

        // éå†æ‰€æœ‰è¡Œ
        for (var i = 0; i < ROW_COUNT; i++) {
            // è®¡æ•°å™¨,è®°å½•æ¯ä¸€è¡Œå­˜åœ¨çš„å—å…ƒç´ çš„æ•°é‡
            var count = 0;
            // éå†æ‰€æœ‰åˆ—
            for (var j = 0; j < COL_COUNT; j++) {
                //  åˆ¤æ–­æ”¹è¡Œè¯¥åˆ—æ˜¯å¦å­˜åœ¨å—å…ƒç´ 
                if (fixedBlocks[i + "_" + j]) {
                    count++;
                }
            }
            // å¦‚æœæ¯ä¸€è¡Œä¸­å­˜åœ¨çš„å—å…ƒç´ æ•°é‡ === åˆ—æ•°ï¼Œè¡¨ç¤ºä¸€è¡Œä¸­æ¯ä¸€åˆ—éƒ½å­˜åœ¨å—å…ƒç´ 
            if (count === COL_COUNT) {
                // åˆ é™¤è¯¥è¡Œ
                removeLine(i);
            }
        }
    }

    // åˆ é™¤æŒ‡å®šè¡Œ
    function removeLine(line) {
        // æ‹¿åˆ°å½“å‰è¡Œæ‰€æœ‰çš„å—å…ƒç´ 
        for (var i = 0; i < COL_COUNT; i++) {
            // 1ã€ä»å®¹å™¨ä¸­åˆ é™¤å…ƒç´ 
            document.getElementById("container").removeChild(fixedBlocks[line + "_" + i]);
            // 2ã€ä»æ•°æ®æºä¸­åˆ é™¤å…ƒç´ 
            fixedBlocks[line + "_" + i] = null;
        }
        downLine(line);
    }

    // è®©æŒ‡å®šè¡Œä¹‹ä¸Šçš„å—å…ƒç´ ä¸‹è½
    function downLine(line) {
        // è®©æŒ‡å®šè¡Œä¹‹ä¸Šçš„æ‰€æœ‰è¡Œä¸­çš„æ¯ä¸€åˆ—çš„å—å…ƒç´ ï¼Œå‘ä¸‹ç§»åŠ¨ 1 ä¸ªæ­¥é•¿
        // éå†æŒ‡å®šè¡Œä¹‹ä¸Šçš„æ‰€æœ‰è¡Œ
        for (var i = (line - 1); i >= 0; i--) {
            // è¿™äº›è¡Œä¸­æ¯ä¸€åˆ—å…ƒç´ 
            for (var j = 0; j < COL_COUNT; j++) {
                // å¦‚æœå½“å‰åˆ—æ²¡æœ‰æ•°æ®è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯
                if (!fixedBlocks[i + "_" + j]) continue;
                // å¦‚æœå½“å‰è¡Œçš„å½“å‰åˆ—å­˜åœ¨å—å…ƒç´ çš„è¯
                // 1ã€å¹³ç§»æ•°æ®ï¼ŒæŠŠå½“å‰è¡Œçš„æ•°æ®ç»™ä¸‹ä¸€è¡Œ
                fixedBlocks[(i + 1) + "_" + j] = fixedBlocks[i + "_" + j];
                // 2ã€å¹³ç§»å…ƒç´ ï¼Œè®©å½“å‰è¡Œçš„å…ƒç´ åˆ°ä¸‹ä¸€è¡Œ
                fixedBlocks[(i + 1) + "_" + j].style.top = (i + 1) * STEP + "px";
                // 3ã€æ¸…ç†æ‰å¹³ç§»ä¹‹å‰çš„æ•°æ®
                fixedBlocks[i + "_" + j] = null;
            }
        }
    }

    // è®©æ¨¡å‹è‡ªåŠ¨ä¸‹è½
    function autoDown() {
        if (mInterval) {
            clearInterval(mInterval);
        }
        mInterval = setInterval(function () {
            move(0, 1);
        }, 600);
    }

    // åˆ¤æ–­æ¸¸æˆç»“æŸ
    function isGameOver() {
        // å½“ç¬¬0è¡Œå­˜åœ¨å—å…ƒç´ è¡¨ç¤ºæ¸¸æˆç»“æŸ
        for (var i = 0; i < COL_COUNT; i++) {
            if (fixedBlocks["0_" + i]) {
                return true;
            }
        }
    }

    // ç»“æŸæ‰æ¸¸æˆ
    function gameOver() {
        // 1ã€åœæ­¢å®šæ—¶å™¨
        if (mInterval) {
            clearInterval(mInterval)
        };
        // 2ã€å¼¹å‡ºå¯¹è¯æ¡†ï¼Œå‘Šè¯‰ç”¨æˆ·æ¸¸æˆç»“æŸäº†
        alert("å¤§å‰å¤§åˆ©ï¼Œä»Šæ™šåƒé¸¡");
    }
</script>

</html>
